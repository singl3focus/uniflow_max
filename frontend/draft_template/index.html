<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniFlow</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .notification-modal {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .modal-header {
            padding: 16px;
            border-bottom: 1px solid #f0f0f0;
            text-align: center;
            position: relative;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .modal-close {
            position: absolute;
            right: 16px;
            top: 16px;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #666;
        }

        .notification-options {
            max-height: 60vh;
            overflow-y: auto;
        }

        .notification-group {
            border-bottom: 1px solid #f0f0f0;
        }

        .notification-group:last-child {
            border-bottom: none;
        }

        .group-title {
            padding: 12px 16px;
            font-size: 14px;
            color: #666;
            background: #f8f9fa;
        }

        .notification-option {
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: background 0.2s ease;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 16px;
        }

        .notification-option:hover {
            background: #f8f9fa;
        }

        .notification-option.selected {
            background: #e3f2fd;
        }

        .checkmark {
            color: #667eea;
            font-weight: bold;
        }

        .custom-notification {
            padding: 16px;
            border-top: 1px solid #f0f0f0;
        }

        .custom-input-group {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }

        .custom-input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .custom-add-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        body {
            background: #f5f7fa;
            color: #333;
            max-width: 400px;
            margin: 0 auto;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .screen {
            display: none;
            padding-bottom: 60px;
            z-index: 900;
        }
        
        .screen.active {
            display: block;
            z-index: 800;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 20px;
            font-weight: 600;
        }

        .back-button {
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
            padding: 8px;
            margin: -8px;
        }

        .date-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-button {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .nav-button:hover {
            background: rgba(255,255,255,0.3);
        }

        .current-date {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
        }

        .date-main {
            font-size: 16px;
            font-weight: 600;
        }

        .date-secondary {
            font-size: 12px;
            opacity: 0.9;
        }

        .progress-section {
            background: white;
            margin: 12px 16px;
            padding: 16px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .progress-text {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }

        .progress-bar {
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            width: 40%;
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .add-task-btn {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            transition: transform 0.2s ease;
            z-index: 100;
        }

        .add-task-btn:hover {
            transform: scale(1.1);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏ */
        .form-container {
            background: white;
            margin: 12px 16px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0.05);
            overflow: hidden;
        }

        .form-section {
            padding: 20px;
            border-bottom: 1px solid #f0f0f0;
        }

        .form-section:last-child {
            border-bottom: none;
        }

        .form-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #333;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            color: #333;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
        }

        .datetime-inputs {
            display: flex;
            gap: 12px;
        }

        .datetime-inputs input {
            flex: 1;
        }

        .notifications-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .notification-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .notification-time {
            font-size: 14px;
            font-weight: 500;
        }

        .notification-remove {
            background: none;
            border: none;
            color: #f44336;
            cursor: pointer;
            padding: 4px;
            margin-left: auto;
        }

        .add-notification-btn {
            background: none;
            border: 1px dashed #667eea;
            color: #667eea;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .add-notification-btn:hover {
            background: #667eea;
            color: white;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .form-button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .form-button.primary {
            background: #667eea;
            color: white;
        }

        .form-button.secondary {
            background: #f8f9fa;
            color: #666;
            border: 1px solid #ddd;
        }

        .form-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0.1);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–º–µ—Ç–æ–∫ –≤ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ */
        .notes-section {
            margin-top: 20px;
        }

        .notes-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .note-item {
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .note-text {
            font-size: 14px;
            line-height: 1.4;
            color: #000;
        }

        .note-meta {
            font-size: 12px;
            color: #888;
            margin-top: 8px;
            display: flex;
            justify-content: space-between;
        }

        .add-note-form {
            margin-top: 16px;
        }

        .add-note-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .add-note-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .section {
            background: white;
            margin: 12px 16px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            overflow: hidden;
        }

        .section-header {
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .section-header:hover {
            background: #f8f9fa;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-count {
            font-size: 12px;
            color: #666;
            font-weight: normal;
        }

        .collapse-icon {
            font-size: 14px;
            color: #666;
            transition: transform 0.3s ease;
        }

        .section.collapsed .collapse-icon {
            transform: rotate(-90deg);
        }

        .task-list {
            display: flex;
            flex-direction: column;
            max-height: 1000px;
            transition: max-height 0.3s ease, opacity 0.3s ease;
            opacity: 1;
        }

        .section.collapsed .task-list {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }

        .overdue .section-title {
            color: #f44336;
        }

        .task-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px 16px;
            border-top: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .task-item:hover {
            background: #f8f9fa;
        }

        .task-color {
            width: 4px;
            height: 40px;
            border-radius: 2px;
            flex-shrink: 0;
        }

        .task-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .task-text {
            font-size: 14px;
            line-height: 1.4;
        }

        .task-meta {
            font-size: 12px;
            color: #888;
            display: flex;
            justify-content: space-between;
        }

        .checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #ddd;
            border-radius: 50%;
            flex-shrink: 0;
            margin-top: 2px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .checkbox.checked {
            background: #4CAF50;
            border-color: #4CAF50;
            position: relative;
        }

        .checkbox.checked::after {
            content: '‚úì';
            color: white;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
        }

        .overdue-task .task-text {
            color: #f44336;
        }

        .empty-state {
            text-align: center;
            padding: 20px;
            color: #888;
            font-size: 14px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —ç–∫—Ä–∞–Ω–∞ –ö–æ–Ω—Ç–µ–∫—Å—Ç—ã */
        .context-tabs {
            display: flex;
            background: white;
            margin: 0 16px;
            border-radius: 12px 12px 0 0;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .context-tab {
            flex: 1;
            text-align: center;
            padding: 12px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            color: #666;
        }

        .context-tab.active {
            background: white;
            color: #667eea;
            font-weight: 600;
        }

        .context-list {
            background: white;
            margin: 0 16px 12px 16px;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .context-item {
            display: flex;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .context-item:last-child {
            border-bottom: none;
        }

        .context-item:hover {
            background: #f8f9fa;
        }

        .context-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .context-info {
            flex: 1;
        }

        .context-name {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .context-stats {
            font-size: 12px;
            color: #888;
        }

        .context-progress {
            width: 60px;
            height: 4px;
            background: #e9ecef;
            border-radius: 2px;
            overflow: hidden;
            margin-left: 12px;
        }

        .context-progress-fill {
            height: 100%;
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        .add-context-btn {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            transition: transform 0.2s ease;
        }

        .add-context-btn:hover {
            transform: scale(1.1);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–¥–∞—á–∏ */
        .task-detail {
            background: white;
            margin: 12px 16px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            overflow: hidden;
        }

        .task-detail-header {
            padding: 20px;
            border-bottom: 1px solid #f0f0f0;
        }

        .task-detail-title {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 16px;
        }

        .task-detail-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid #ddd;
            border-radius: 50%;
            flex-shrink: 0;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 2px;
        }

        .task-detail-checkbox.checked {
            background: #4CAF50;
            border-color: #4CAF50;
            position: relative;
        }

        .task-detail-checkbox.checked::after {
            content: '‚úì';
            color: white;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 14px;
        }

        .task-detail-text {
            flex: 1;
            font-size: 18px;
            font-weight: 500;
            line-height: 1.4;
        }

        .task-detail-meta {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .detail-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .detail-label {
            font-size: 14px;
            color: #666;
            min-width: 80px;
        }

        .detail-value {
            font-size: 14px;
            font-weight: 500;
        }

        .context-badge {
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
            color: white;
        }

        .priority-badge {
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
            color: white;
        }

        .priority-high { background: #f44336; }
        .priority-medium { background: #ff9800; }
        .priority-low { background: #4CAF50; }

        .task-detail-body {
            padding: 20px;
        }

        .detail-section {
            margin-bottom: 24px;
        }

        .detail-section:last-child {
            margin-bottom: 0;
        }

        .detail-section-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #333;
        }

        .description-text {
            font-size: 14px;
            line-height: 1.5;
            color: #666;
        }

        .description-placeholder {
            font-size: 14px;
            color: #999;
            font-style: italic;
        }

        .attachments-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .attachment-item {
            aspect-ratio: 1;
            background: #f8f9fa;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .attachment-item:hover {
            background: #e9ecef;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .action-button {
            flex: 1;
            padding: 12px;
            border: 1px solid #667eea;
            border-radius: 8px;
            background: white;
            color: #667eea;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .action-button.primary {
            background: #667eea;
            color: white;
        }

        .action-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 400px;
            background: white;
            display: flex;
            border-top: 1px solid #eee;
            padding: 8px 0;
        }

        .nav-item {
            flex: 1;
            text-align: center;
            padding: 8px;
            font-size: 12px;
            color: #666;
            text-decoration: none;
            transition: color 0.2s ease;
            cursor: pointer;
            border: none;
            background: none;
        }

        .nav-item.active {
            color: #667eea;
            font-weight: 600;
        }

        .nav-icon {
            font-size: 18px;
            margin-bottom: 2px;
        }

        /* –¶–≤–µ—Ç–∞ –¥–ª—è –ø—Ä–µ–¥–º–µ—Ç–æ–≤ */
        .color-math { background: #667eea; }
        .color-physics { background: #f093fb; }
        .color-history { background: #f44336; }
        .color-general { background: #4CAF50; }
        .color-programming { background: #ff9800; }
        .color-english { background: #9c27b0; }
        .color-chemistry { background: #009688; }

        .badge-math { background: #667eea; }
        .badge-physics { background: #f093fb; }
        .badge-history { background: #f44336; }
        .badge-general { background: #4CAF50; }
    </style>
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω –°–µ–≥–æ–¥–Ω—è -->
    <div class="screen active" id="todayScreen">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="header">
            <div class="header-top">
                <h1>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h1>
            </div>
            
            <div class="date-navigation">
                <button class="nav-button" onclick="changeDate(-1)">‚Üê</button>
                
                <div class="current-date">
                    <div class="date-main" id="currentDate">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 25 –¥–µ–∫</div>
                    <div class="date-secondary" id="currentWeek">–ù–µ–¥–µ–ª—è 52</div>
                </div>
                
                <button class="nav-button" onclick="changeDate(1)">‚Üí</button>
            </div>
        </div>
   

        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –¥–Ω—è -->
        <div class="progress-section">
            <div class="progress-text">–ü—Ä–æ–≥—Ä–µ—Å—Å –¥–Ω—è: <span id="progressText">2/5</span> –∑–∞–¥–∞—á</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <!-- –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ -->
        <div class="section overdue" id="overdueSection">
            <div class="section-header" onclick="toggleSection('overdueSection')">
                <div class="section-title">
                    –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ
                    <span class="section-count" id="overdueCount">1 –∑–∞–¥–∞—á–∞</span>
                </div>
                <div class="collapse-icon">‚ñº</div>
            </div>
            <div class="task-list" id="overdueTasks">
                <!-- –ó–∞–¥–∞—á–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>

        <!-- –ó–∞–¥–∞—á–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è -->
        <div class="section" id="todaySection">
            <div class="section-header" onclick="toggleSection('todaySection')">
                <div class="section-title">
                    –ó–∞–¥–∞—á–∏ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –¥–µ–Ω—å
                    <span class="section-count" id="todayCount">4 –∑–∞–¥–∞—á–∏</span>
                </div>
                <div class="collapse-icon">‚ñº</div>
            </div>
            <div class="task-list" id="todayTasks">
                <!-- –ó–∞–¥–∞—á–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ -->
    <button class="add-task-btn" onclick="openCreateTaskForm()">+</button>
    </div>

    <!-- –≠–∫—Ä–∞–Ω —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏ -->
    <div class="screen" id="createTaskScreen">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="header">
            <div class="header-top">
                <button class="back-button" onclick="switchScreen('todayScreen')">‚Üê –ù–∞–∑–∞–¥</button>
                <h1>–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</h1>
                <div style="width: 48px;"></div>
            </div>
        </div>

        <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏ -->
        <div class="form-container">
            <div class="form-section">
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ *</label>
                    <input type="text" class="form-input" id="taskTitle" placeholder="–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?">
                </div>

                <div class="form-group">
                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea class="form-textarea" id="taskDescription" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ—Ç–∞–ª–∏..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">–ü—Ä–µ–¥–º–µ—Ç *</label>
                    <select class="form-select" id="taskSubject">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç</option>
                        <option value="math">–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</option>
                        <option value="physics">–§–∏–∑–∏–∫–∞</option>
                        <option value="history">–ò—Å—Ç–æ—Ä–∏—è</option>
                        <option value="programming">–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ</option>
                        <option value="english">–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫</option>
                        <option value="general">–û–±—â–µ–µ</option>
                    </select>
                </div>
            </div>

            <div class="form-section">
                <div class="form-title">–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</div>
                
                <div class="form-group">
                    <label class="form-label">–î–∞—Ç–∞ –¥–µ–¥–ª–∞–π–Ω–∞ *</label>
                    <input type="date" class="form-input" id="taskDeadline">
                </div>

                <div class="form-group">
                    <label class="form-label">–í—Ä–µ–º—è –¥–µ–¥–ª–∞–π–Ω–∞</label>
                    <input type="time" class="form-input" id="taskTime">
                </div>
            </div>

            <div class="form-section">
                <div class="form-title">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</div>
                
                <div class="form-group">
                    <label class="form-label">–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</label>
                    <div class="notifications-list" id="notificationsList">
                        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                    <button class="add-notification-btn" onclick="addNotification()">+ –î–æ–±–∞–≤–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ</button>
                </div>
            </div>

            <div class="form-section">
                <div class="form-group">
                    <label class="form-label">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</label>
                    <select class="form-select" id="taskPriority">
                        <option value="low">–ù–∏–∑–∫–∏–π</option>
                        <option value="medium" selected>–°—Ä–µ–¥–Ω–∏–π</option>
                        <option value="high">–í—ã—Å–æ–∫–∏–π</option>
                    </select>
                </div>
            </div>

            <div class="form-section">
                <div class="form-actions">
                    <button class="form-button secondary" onclick="switchScreen('todayScreen')">–û—Ç–º–µ–Ω–∞</button>
                    <button class="form-button primary" onclick="createTask()">–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –ö–æ–Ω—Ç–µ–∫—Å—Ç—ã -->
    <div class="screen" id="contextsScreen">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="header">
            <div class="header-top">
                <h1>–ö–æ–Ω—Ç–µ–∫—Å—Ç—ã</h1>
            </div>
        </div>

        <!-- –¢–∞–±—ã -->
        <div class="context-tabs">
            <button class="context-tab active" onclick="switchContextTab('subjects')">–ü—Ä–µ–¥–º–µ—Ç—ã</button>
            <button class="context-tab" onclick="switchContextTab('goals')">–¶–µ–ª–∏</button>
            <button class="context-tab" onclick="switchContextTab('schedule')">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</button>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ -->
        <div class="context-list" id="contextsList">
            <!-- –ö–æ–Ω—Ç–µ–∫—Å—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
        <button class="add-context-btn" onclick="addNewContext()">+</button>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –í—Ö–æ–¥—è—â–∏–µ -->
    <div class="screen" id="inboxScreen">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="header">
            <div class="header-top">
                <h1>–í—Ö–æ–¥—è—â–∏–µ</h1>
            </div>
        </div>

        <div class="section">
            <div class="section-header">
                <div class="section-title">
                    –ù–µ–ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
                    <span class="section-count">3 –∑–∞–¥–∞—á–∏</span>
                </div>
                <div class="collapse-icon">‚ñº</div>
            </div>
            <div class="task-list">
                <div class="task-item">
                    <div class="task-color color-general"></div>
                    <div class="task-content">
                        <div class="task-text">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é</div>
                        <div class="task-meta">
                            <span>–û–±—â–µ–µ</span>
                            <span>–ë–µ–∑ —Å—Ä–æ–∫–∞</span>
                        </div>
                    </div>
                    <div class="checkbox"></div>
                </div>
                <div class="task-item">
                    <div class="task-color color-general"></div>
                    <div class="task-content">
                        <div class="task-text">–ö—É–ø–∏—Ç—å —É—á–µ–±–Ω–∏–∫–∏</div>
                        <div class="task-meta">
                            <span>–û–±—â–µ–µ</span>
                            <span>–ë–µ–∑ —Å—Ä–æ–∫–∞</span>
                        </div>
                    </div>
                    <div class="checkbox"></div>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-header">
                <div class="section-title">
                    –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫
                </div>
            </div>
            <div style="padding: 16px;">
                <input type="text" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∑–∞–¥–∞—á–∞–º –∏ –∫–æ–Ω—Å–ø–µ–∫—Ç–∞–º..." style="
                    width: 100%;
                    padding: 12px;
                    border: 1px solid #ddd;
                    border-radius: 8px;
                    font-size: 14px;
                ">
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –î–µ—Ç–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–¥–∞—á–∏ -->
    <div class="screen" id="taskDetailScreen">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="header">
            <div class="header-top">
                <button class="back-button" onclick="switchScreen('todayScreen')">‚Üê –ù–∞–∑–∞–¥</button>
                <h1>–ó–∞–¥–∞—á–∞</h1>
                <div style="width: 48px;"></div> <!-- –î–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è -->
            </div>
        </div>

        <!-- –î–µ—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ -->
        <div class="task-detail" id="taskDetailContent">
            <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
    </div>

    <!-- –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="nav">
        <button class="nav-item active" onclick="switchScreen('todayScreen')">
            <div class="nav-icon">üìÖ</div>
            <div>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</div>
        </button>
        <button class="nav-item" onclick="switchScreen('contextsScreen')">
            <div class="nav-icon">üìö</div>
            <div>–ö–æ–Ω—Ç–µ–∫—Å—Ç—ã</div>
        </button>
        <button class="nav-item" onclick="switchScreen('inboxScreen')">
            <div class="nav-icon">üì•</div>
            <div>–í—Ö–æ–¥—è—â–∏–µ</div>
        </button>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div class="modal-overlay" id="notificationModal">
        <div class="notification-modal">
            <div class="modal-header">
                <div class="modal-title">–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ</div>
                <button class="modal-close" onclick="closeNotificationModal()">√ó</button>
            </div>
            <div class="notification-options">
                <div class="notification-group">
                    <div class="group-title">–í –º–æ–º–µ–Ω—Ç —Å–æ–±—ã—Ç–∏—è</div>
                    <button class="notification-option" onclick="selectNotification('–í –º–æ–º–µ–Ω—Ç —Å–æ–±—ã—Ç–∏—è', '0 minutes')">
                        –í –º–æ–º–µ–Ω—Ç —Å–æ–±—ã—Ç–∏—è
                        <span class="checkmark" style="display: none;">‚úì</span>
                    </button>
                </div>
   
                <div class="notification-group">
                    <div class="group-title">–ü–µ—Ä–µ–¥ —Å–æ–±—ã—Ç–∏–µ–º</div>
                    <button class="notification-option" onclick="selectNotification('–ó–∞ 5 –º–∏–Ω—É—Ç', '5 minutes')">
                        –ó–∞ 5 –º–∏–Ω—É—Ç
                        <span class="checkmark" style="display: none;">‚úì</span>
                    </button>
                    <button class="notification-option" onclick="selectNotification('–ó–∞ 10 –º–∏–Ω—É—Ç', '10 minutes')">
                        –ó–∞ 10 –º–∏–Ω—É—Ç
                        <span class="checkmark" style="display: none;">‚úì</span>
                    </button>
                    <button class="notification-option" onclick="selectNotification('–ó–∞ 15 –º–∏–Ω—É—Ç', '15 minutes')">
                        –ó–∞ 15 –º–∏–Ω—É—Ç
                        <span class="checkmark" style="display: none;">‚úì</span>
                    </button>
                    <button class="notification-option" onclick="selectNotification('–ó–∞ 30 –º–∏–Ω—É—Ç', '30 minutes')">
                        –ó–∞ 30 –º–∏–Ω—É—Ç
                        <span class="checkmark" style="display: none;">‚úì</span>
                    </button>
                </div>
   
                <div class="notification-group">
                    <div class="group-title">–ó–∞–±–ª–∞–≥–æ–≤—Ä–µ–º–µ–Ω–Ω–æ</div>
                    <button class="notification-option" onclick="selectNotification('–ó–∞ 1 —á–∞—Å', '1 hour')">
                        –ó–∞ 1 —á–∞—Å
                        <span class="checkmark" style="display: none;">‚úì</span>
                    </button>
                    <button class="notification-option" onclick="selectNotification('–ó–∞ 2 —á–∞—Å–∞', '2 hours')">
                        –ó–∞ 2 —á–∞—Å–∞
                        <span class="checkmark" style="display: none;">‚úì</span>
                    </button>
                    <button class="notification-option" onclick="selectNotification('–ó–∞ 1 –¥–µ–Ω—å', '1 day')">
                        –ó–∞ 1 –¥–µ–Ω—å
                        <span class="checkmark" style="display: none;">‚úì</span>
                    </button>
                    <button class="notification-option" onclick="selectNotification('–ó–∞ 2 –¥–Ω—è', '2 days')">
                        –ó–∞ 2 –¥–Ω—è
                        <span class="checkmark" style="display: none;">‚úì</span>
                    </button>
                    <button class="notification-option" onclick="selectNotification('–ó–∞ 1 –Ω–µ–¥–µ–ª—é', '1 week')">
                        –ó–∞ 1 –Ω–µ–¥–µ–ª—é
                        <span class="checkmark" style="display: none;">‚úì</span>
                    </button>
                </div>
   
                <div class="notification-group">
                    <div class="group-title">–ë–µ–∑ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</div>
                    <button class="notification-option" onclick="selectNotification('–ù–µ—Ç', 'none')">
                        –ù–µ—Ç
                        <span class="checkmark" style="display: none;">‚úì</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –î–∞–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
        const tasksByDate = {
            '2024-12-24': [
                { 
                    id: 1, 
                    text: '–°–¥–∞—Ç—å –∫–æ–Ω—Å–ø–µ–∫—Ç –ø–æ –§–∏–∑–∏–∫–µ', 
                    subject: '–§–∏–∑–∏–∫–∞', 
                    color: 'physics', 
                    time: '–í—á–µ—Ä–∞', 
                    completed: false,
                    priority: 'high',
                    description: '–ö–æ–Ω—Å–ø–µ–∫—Ç –ø–æ —Ç–µ–º–µ "–¢–µ—Ä–º–æ–¥–∏–Ω–∞–º–∏–∫–∞". –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ñ–æ—Ä–º–∏—Ç—å –≤—Å–µ —Ñ–æ—Ä–º—É–ª—ã –∏ –ø—Ä–∏–º–µ—Ä—ã –∑–∞–¥–∞—á.',
                    attachments: ['üì∑', 'üìÑ', 'üìé'],
                    createdAt: '2024-12-20',
                    deadline: '2024-12-24'
                }
            ],
            '2024-12-25': [
                { 
                    id: 2, 
                    text: '–†–µ—à–∏—Ç—å –î–ó ‚Ññ5 –ø–æ –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–º—É –∞–Ω–∞–ª–∏–∑—É', 
                    subject: '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', 
                    color: 'math', 
                    time: '–¥–æ 18:00', 
                    completed: false,
                    priority: 'medium',
                    description: '–ó–∞–¥–∞—á–∏ –Ω–∞ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è. –û—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ —É–¥–µ–ª–∏—Ç—å –∑–∞–¥–∞—á–µ ‚Ññ3.',
                    attachments: ['üìÑ'],
                    createdAt: '2024-12-22',
                    deadline: '2024-12-25'
                },
                { 
                    id: 3, 
                    text: '–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ —Å–µ–º–∏–Ω–∞—Ä—É –ø–æ –§–∏–∑–∏–∫–µ', 
                    subject: '–§–∏–∑–∏–∫–∞', 
                    color: 'physics', 
                    time: '–¥–æ 14:30', 
                    completed: true,
                    priority: 'high',
                    description: '–¢–µ–º–∞ —Å–µ–º–∏–Ω–∞—Ä–∞: "–ö–≤–∞–Ω—Ç–æ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞". –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã 1-5.',
                    attachments: ['üì∑', 'üìé'],
                    createdAt: '2024-12-23',
                    deadline: '2024-12-25'
                },
                { 
                    id: 4, 
                    text: '–ü—Ä–æ—á–∏—Ç–∞—Ç—å –≥–ª–∞–≤—É 3 –ø–æ –ò—Å—Ç–æ—Ä–∏–∏', 
                    subject: '–ò—Å—Ç–æ—Ä–∏—è', 
                    color: 'history', 
                    time: '–¥–æ 22:00', 
                    completed: false,
                    priority: 'low',
                    description: '',
                    attachments: [],
                    createdAt: '2024-12-24',
                    deadline: '2024-12-25'
                },
                { 
                    id: 5, 
                    text: '–ù–∞–ø–∏—Å–∞—Ç—å –ø–ª–∞–Ω –∫—É—Ä—Å–æ–≤–æ–π —Ä–∞–±–æ—Ç—ã', 
                    subject: '–ö—É—Ä—Å–æ–≤–∞—è', 
                    color: 'general', 
                    time: '–¥–æ 20:00', 
                    completed: true,
                    priority: 'medium',
                    description: '–°–æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–π –ø–ª–∞–Ω –∫—É—Ä—Å–æ–≤–æ–π –ø–æ —Ç–µ–º–µ "–í–ª–∏—è–Ω–∏–µ —Ü–∏—Ñ—Ä–æ–≤–∏–∑–∞—Ü–∏–∏ –Ω–∞ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ".',
                    attachments: ['üìÑ'],
                    createdAt: '2024-12-20',
                    deadline: '2024-12-25'
                }
            ]
        };

        const contexts = {
            subjects: [
                { id: 1, name: '–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑', color: 'math', tasks: 12, completed: 5, type: 'subject' },
                { id: 2, name: '–§–∏–∑–∏–∫–∞', color: 'physics', tasks: 8, completed: 3, type: 'subject' },
                { id: 3, name: '–ò—Å—Ç–æ—Ä–∏—è', color: 'history', tasks: 6, completed: 2, type: 'subject' }
            ],
            goals: [
                { id: 6, name: '–ó–∞–∫—Ä—ã—Ç—å —Å–µ—Å—Å–∏—é –Ω–∞ –æ—Ç–ª–∏—á–Ω–æ', color: 'general', tasks: 25, completed: 12, type: 'goal' },
                { id: 7, name: '–ù–∞–ø–∏—Å–∞—Ç—å –∫—É—Ä—Å–æ–≤—É—é –ø–æ –§–∏–∑–∏–∫–µ', color: 'physics', tasks: 8, completed: 2, type: 'goal' }
            ],
            schedule: [
                { id: 9, name: '–õ–µ–∫—Ü–∏—è –ø–æ –ú–∞—Ç–µ–º–∞—Ç–∏–∫–µ', color: 'math', tasks: 0, completed: 0, type: 'schedule', time: '–ü–ù 10:00' },
                { id: 10, name: '–°–µ–º–∏–Ω–∞—Ä –ø–æ –§–∏–∑–∏–∫–µ', color: 'physics', tasks: 0, completed: 0, type: 'schedule', time: '–í–¢ 14:00' }
            ]
        };

        let currentDate = new Date('2024-12-25');
        let currentContextTab = 'subjects';
        let currentTask = null;
        let notifications = [];

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–¥–∞—á–∏
        function openTaskDetail(task, dateKey) {
            currentTask = { ...task, dateKey };
            renderTaskDetail();
            switchScreen('taskDetailScreen');
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
        function renderTaskDetail() {
            const container = document.getElementById('taskDetailContent');
            if (!currentTask) return;

            const priorityText = {
                'high': '–í—ã—Å–æ–∫–∏–π',
                'medium': '–°—Ä–µ–¥–Ω–∏–π',
                'low': '–ù–∏–∑–∫–∏–π'
            };

            container.innerHTML = `
                <div class="task-detail-header">
                    <div class="task-detail-title">
                        <div class="task-detail-checkbox ${currentTask.completed ? 'checked' : ''}" 
                             onclick="toggleTaskDetail()"></div>
                        <div class="task-detail-text">${currentTask.text}</div>
                    </div>
                    <div class="task-detail-meta">
                        <div class="detail-row">
                            <div class="detail-label">–ü—Ä–µ–¥–º–µ—Ç:</div>
                            <div class="context-badge badge-${currentTask.color}">${currentTask.subject}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:</div>
                            <div class="priority-badge priority-${currentTask.priority}">
                                ${priorityText[currentTask.priority]}
                            </div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">–°–æ–∑–¥–∞–Ω–∞:</div>
                            <div class="detail-value">${formatDisplayDate(currentTask.createdAt)}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">–î–µ–¥–ª–∞–π–Ω:</div>
                            <div class="detail-value">${formatDisplayDate(currentTask.deadline)} ${currentTask.time.replace('–¥–æ ', '')}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">–°—Ç–∞—Ç—É—Å:</div>
                            <div class="detail-value">${currentTask.completed ? '‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∞' : '‚è≥ –í —Ä–∞–±–æ—Ç–µ'}</div>
                        </div>
                    </div>
                </div>
                <div class="task-detail-body">
                    <div class="detail-section">
                        <div class="detail-section-title">–û–ø–∏—Å–∞–Ω–∏–µ</div>
                        <div class="description-text">
                            ${currentTask.description ? currentTask.description : 
                            '<div class="description-placeholder">–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</div>'}
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <div class="detail-section-title">–í–ª–æ–∂–µ–Ω–∏—è</div>
                        ${currentTask.attachments.length > 0 ? `
                            <div class="attachments-grid">
                                ${currentTask.attachments.map((att, index) => `
                                    <div class="attachment-item" onclick="openAttachment(${index})">
                                        ${att}
                                    </div>
                                `).join('')}
                            </div>
                        ` : '<div class="description-placeholder">–í–ª–æ–∂–µ–Ω–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</div>'}
                    </div>
                    
                    <div class="action-buttons">
                        <button class="action-button" onclick="editTask()">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button class="action-button primary" onclick="completeTask()">
                            ${currentTask.completed ? 'üîÑ –í–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å' : '‚úÖ –í—ã–ø–æ–ª–Ω–∏—Ç—å'}
                        </button>
                    </div>
                </div>
            `;
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function formatDisplayDate(dateString) {
            const date = new Date(dateString);
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            if (date.toDateString() === today.toDateString()) {
                return '–°–µ–≥–æ–¥–Ω—è';
            } else if (date.toDateString() === yesterday.toDateString()) {
                return '–í—á–µ—Ä–∞';
            } else {
                const options = { day: 'numeric', month: 'long' };
                return date.toLocaleDateString('ru-RU', options);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function formatNotificationTime(dateTime) {
            const date = new Date(dateTime);
            return date.toLocaleString('ru-RU', {
                day: 'numeric',
                month: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏ –≤ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ
        function toggleTaskDetail() {
            if (currentTask) {
                currentTask.completed = !currentTask.completed;
                renderTaskDetail();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–¥–∞—á—É –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Å–ø–∏—Å–∫–µ
                if (tasksByDate[currentTask.dateKey]) {
                    const taskIndex = tasksByDate[currentTask.dateKey].findIndex(t => t.id === currentTask.id);
                    if (taskIndex !== -1) {
                        tasksByDate[currentTask.dateKey][taskIndex].completed = currentTask.completed;
                    }
                }
            }
        }

        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
        function completeTask() {
            toggleTaskDetail();
            setTimeout(() => {
                alert('–ó–∞–¥–∞—á–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!');
            }, 300);
        }

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
        function editTask() {
            alert('–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–∫—Ä—ã—Ç —Ä–µ–¥–∞–∫—Ç–æ—Ä –∑–∞–¥–∞—á–∏\n–í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –±—É–¥–µ—Ç —Ñ–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –≤–ª–æ–∂–µ–Ω–∏—è
        function openAttachment(index) {
            const attachmentTypes = ['üì∑', 'üìÑ', 'üìé'];
            const typeNames = ['–§–æ—Ç–æ', '–î–æ–∫—É–º–µ–Ω—Ç', '–°—Å—ã–ª–∫–∞'];
            alert(`–û—Ç–∫—Ä—ã—Ç—å –≤–ª–æ–∂–µ–Ω–∏–µ: ${typeNames[index]}\n–í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –±—É–¥–µ—Ç –æ—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–∞–π–ª–∞`);
        }

        // –°–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ/—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ —Å–µ–∫—Ü–∏–π
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            section.classList.toggle('collapsed');
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–æ–≤
        function switchScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            document.getElementById(screenId).classList.add('active');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é —Ç–æ–ª—å–∫–æ –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —ç–∫—Ä–∞–Ω–æ–≤
            if (['todayScreen', 'contextsScreen', 'inboxScreen'].includes(screenId)) {
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                event.target.classList.add('active');
            }
            
            if (screenId === 'contextsScreen') {
                renderContexts();
            }
        }

        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π...
        function switchContextTab(tab) {
            currentContextTab = tab;
            document.querySelectorAll('.context-tab').forEach(tabElement => {
                tabElement.classList.remove('active');
            });
            event.target.classList.add('active');
            renderContexts();
        }

        function renderContexts() {
            const container = document.getElementById('contextsList');
            const contextList = contexts[currentContextTab];
            container.innerHTML = '';
            
            if (contextList.length === 0) {
                container.innerHTML = '<div class="empty-state">–ü–æ–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç</div>';
                return;
            }
            
            contextList.forEach(context => {
                const progressPercent = context.tasks > 0 ? (context.completed / context.tasks) * 100 : 0;
                const contextElement = document.createElement('div');
                contextElement.className = 'context-item';
                contextElement.innerHTML = `
                    <div class="context-color color-${context.color}"></div>
                    <div class="context-info">
                        <div class="context-name">${context.name}</div>
                        <div class="context-stats">
                            ${context.type === 'schedule' ? context.time : `${context.completed}/${context.tasks} –∑–∞–¥–∞—á`}
                        </div>
                    </div>
                    ${context.type !== 'schedule' ? `
                        <div class="context-progress">
                            <div class="context-progress-fill color-${context.color}" style="width: ${progressPercent}%"></div>
                        </div>
                    ` : ''}
                `;
                contextElement.addEventListener('click', () => {
                    alert(`–û—Ç–∫—Ä—ã—Ç—å –¥–µ—Ç–∞–ª–∏: ${context.name}`);
                });
                container.appendChild(contextElement);
            });
        }

        function addNewContext() {
            const contextType = currentContextTab === 'subjects' ? '–ø—Ä–µ–¥–º–µ—Ç' : 
                              currentContextTab === 'goals' ? '—Ü–µ–ª—å' : '—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ';
            const name = prompt(`–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ ${contextType}:`);
            if (name && name.trim()) {
                alert(`–ù–æ–≤—ã–π ${contextType} "${name}" —Å–æ–∑–¥–∞–Ω!`);
            }
        }

        function formatDate(date) {
            const days = ['–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ', '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞', '–°—É–±–±–æ—Ç–∞'];
            const months = ['—è–Ω–≤', '—Ñ–µ–≤', '–º–∞—Ä', '–∞–ø—Ä', '–º–∞—è', '–∏—é–Ω', '–∏—é–ª', '–∞–≤–≥', '—Å–µ–Ω', '–æ–∫—Ç', '–Ω–æ—è', '–¥–µ–∫'];
            const dayName = days[date.getDay()];
            const day = date.getDate();
            const month = months[date.getMonth()];
            const startOfYear = new Date(date.getFullYear(), 0, 1);
            const weekNumber = Math.ceil(((date - startOfYear) / 86400000 + startOfYear.getDay() + 1) / 7);
            return {
                main: `${dayName}, ${day} ${month}`,
                week: `–ù–µ–¥–µ–ª—è ${weekNumber}`
            };
        }

        function formatDateKey(date) {
            return date.toISOString().split('T')[0];
        }

        function updateInterface() {
            const dateInfo = formatDate(currentDate);
            document.getElementById('currentDate').textContent = dateInfo.main;
            document.getElementById('currentWeek').textContent = dateInfo.week;
            const dateKey = formatDateKey(currentDate);
            const tasks = tasksByDate[dateKey] || [];
            const overdueTasks = getOverdueTasks();
            renderTasks(tasks, overdueTasks);
            updateProgress(tasks);
            updateCounts(tasks, overdueTasks);
        }

        function getOverdueTasks() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const overdue = [];
            for (const [dateKey, tasks] of Object.entries(tasksByDate)) {
                const taskDate = new Date(dateKey);
                if (taskDate < today) {
                    tasks.forEach(task => {
                        if (!task.completed) {
                            overdue.push({...task, overdueDate: dateKey});
                        }
                    });
                }
            }
            return overdue;
        }

        function renderTasks(tasks, overdueTasks) {
            const todayTasksContainer = document.getElementById('todayTasks');
            const overdueTasksContainer = document.getElementById('overdueTasks');
            todayTasksContainer.innerHTML = '';
            overdueTasksContainer.innerHTML = '';
            
            if (overdueTasks.length > 0) {
                overdueTasks.forEach(task => {
                    const taskElement = createTaskElement(task, true);
                    overdueTasksContainer.appendChild(taskElement);
                });
            } else {
                overdueTasksContainer.innerHTML = '<div class="empty-state">–ù–µ—Ç –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á üéâ</div>';
            }
            
            if (tasks.length > 0) {
                tasks.forEach(task => {
                    const taskElement = createTaskElement(task, false);
                    todayTasksContainer.appendChild(taskElement);
                });
            } else {
                todayTasksContainer.innerHTML = '<div class="empty-state">–ù–µ—Ç –∑–∞–¥–∞—á –Ω–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å üìù</div>';
            }
        }

        function createTaskElement(task, isOverdue) {
            const taskDiv = document.createElement('div');
            taskDiv.className = `task-item ${isOverdue ? 'overdue-task' : ''}`;
            taskDiv.innerHTML = `
                <div class="task-color color-${task.color}"></div>
                <div class="task-content">
                    <div class="task-text">${task.text}</div>
                    <div class="task-meta">
                        <span>${task.subject}</span>
                        <span>${task.time}</span>
                    </div>
                </div>
                <div class="checkbox ${task.completed ? 'checked' : ''}" 
                     onclick="event.stopPropagation(); toggleTask(${task.id}, '${formatDateKey(currentDate)}')"></div>
            `;
            taskDiv.addEventListener('click', () => {
                openTaskDetail(task, formatDateKey(currentDate));
            });
            return taskDiv;
        }

        function updateProgress(tasks) {
            const totalTasks = tasks.length;
            const completedTasks = tasks.filter(task => task.completed).length;
            const progressText = document.getElementById('progressText');
            const progressFill = document.getElementById('progressFill');
            if (totalTasks > 0) {
                progressText.textContent = `${completedTasks}/${totalTasks}`;
                progressFill.style.width = `${(completedTasks / totalTasks) * 100}%`;
            } else {
                progressText.textContent = '0/0';
                progressFill.style.width = '0%';
            }
        }

        function updateCounts(tasks, overdueTasks) {
            document.getElementById('todayCount').textContent = `${tasks.length} ${getTaskWord(tasks.length)}`;
            document.getElementById('overdueCount').textContent = `${overdueTasks.length} ${getTaskWord(overdueTasks.length)}`;
        }

        function getTaskWord(count) {
            if (count % 10 === 1 && count % 100 !== 11) return '–∑–∞–¥–∞—á–∞';
            if (count % 10 >= 2 && count % 10 <= 4 && (count % 100 < 10 || count % 100 >= 20)) return '–∑–∞–¥–∞—á–∏';
            return '–∑–∞–¥–∞—á';
        }

        function toggleTask(taskId, dateKey) {
            event.stopPropagation();
            if (tasksByDate[dateKey]) {
                const task = tasksByDate[dateKey].find(t => t.id === taskId);
                if (task) {
                    task.completed = !task.completed;
                    updateInterface();
                    if (task.completed) {
                        const completedCount = tasksByDate[dateKey].filter(t => t.completed).length;
                        if (completedCount % 5 === 0) {
                            setTimeout(() => {
                                alert(`–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! –¢—ã –∑–∞–∫—Ä—ã–ª —É–∂–µ ${completedCount} –∑–∞–¥–∞—á —Å–µ–≥–æ–¥–Ω—è. –ü—Ä–æ–¥–æ–ª–∂–∞–π –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ! üí™`);
                            }, 300);
                        }
                    }
                }
            }
        }

        function changeDate(days) {
            currentDate.setDate(currentDate.getDate() + days);
            updateInterface();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            updateInterface();
            renderContexts();
        });

        // –û—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏
        function openCreateTaskForm() {
            notifications = [];
            document.getElementById('taskTitle').value = '';
            document.getElementById('taskDescription').value = '';
            document.getElementById('taskSubject').value = '';
            document.getElementById('taskDeadline').value = '';
            document.getElementById('taskTime').value = '';
            document.getElementById('taskPriority').value = 'medium';
            updateNotificationsList();
            switchScreen('createTaskScreen');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
        function openNotificationModal() {
            document.getElementById('notificationModal').classList.add('active');
        }
        
        function closeNotificationModal() {
            document.getElementById('notificationModal').classList.remove('active');
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ overlay –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        document.getElementById('notificationModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeNotificationModal();
            }
        });

        function selectNotification(text, value) {
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —É –≤—Å–µ—Ö –æ–ø—Ü–∏–π
            document.querySelectorAll('.notification-option').forEach(option => {
                option.classList.remove('selected');
                option.querySelector('.checkmark').style.display = 'none';
            });
            
            // –ù–∞—Ö–æ–¥–∏–º –∏ –≤—ã–¥–µ–ª—è–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –æ–ø—Ü–∏—é, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –ø—Ä–æ–∏–∑–æ—à–ª–æ —Å–æ–±—ã—Ç–∏–µ
            const clickedOption = event.target.closest('.notification-option');
            if (clickedOption) {
                clickedOption.classList.add('selected');
                clickedOption.querySelector('.checkmark').style.display = 'inline';
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–æ–∫
            if (value !== 'none') {
                const notificationId = Date.now();
                notifications.push({
                    id: notificationId,
                    text: text,
                    value: value
                });
                updateNotificationsList();
            }
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —á–µ—Ä–µ–∑ –∫–æ—Ä–æ—Ç–∫—É—é –∑–∞–¥–µ—Ä–∂–∫—É
            setTimeout(closeNotificationModal, 300);
            
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –≤—Å–ø–ª—ã—Ç–∏–µ —Å–æ–±—ã—Ç–∏—è, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
            event.stopPropagation();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–≤—ã–∑—ã–≤–∞–µ—Ç –æ—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞)
        function addNotification() {
            openNotificationModal();
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function removeNotification(id) {
            notifications = notifications.filter(notif => notif.id !== id);
            updateNotificationsList();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function updateNotificationsList() {
            const container = document.getElementById('notificationsList');
            container.innerHTML = '';
            
            if (notifications.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #888; font-size: 14px;">–ù–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π</div>';
                return;
            }
            
            notifications.forEach(notification => {
                const notificationElement = document.createElement('div');
                notificationElement.className = 'notification-item';
                notificationElement.innerHTML = `
                    <div>üîî</div>
                    <div class="notification-time">${notification.text}</div>
                    <button class="notification-remove" onclick="removeNotification(${notification.id})">√ó</button>
                `;
                container.appendChild(notificationElement);
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function calculateTriggerTime(deadlineDateTime, offset) {
            const deadline = new Date(deadlineDateTime);
            
            switch(offset) {
                case '0 minutes':
                    return deadline;
                case '5 minutes':
                    return new Date(deadline.getTime() - 5 * 60 * 1000);
                case '10 minutes':
                    return new Date(deadline.getTime() - 10 * 60 * 1000);
                case '15 minutes':
                    return new Date(deadline.getTime() - 15 * 60 * 1000);
                case '30 minutes':
                    return new Date(deadline.getTime() - 30 * 60 * 1000);
                case '1 hour':
                    return new Date(deadline.getTime() - 60 * 60 * 1000);
                case '2 hours':
                    return new Date(deadline.getTime() - 2 * 60 * 60 * 1000);
                case '1 day':
                    return new Date(deadline.getTime() - 24 * 60 * 60 * 1000);
                case '2 days':
                    return new Date(deadline.getTime() - 2 * 24 * 60 * 1000);
                case '1 week':
                    return new Date(deadline.getTime() - 7 * 24 * 60 * 60 * 1000);
                default:
                    return deadline;
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏
        function createTask() {
            const title = document.getElementById('taskTitle').value.trim();
            const subject = document.getElementById('taskSubject').value;
            const deadline = document.getElementById('taskDeadline').value;
            
            if (!title || !subject || !deadline) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (–Ω–∞–∑–≤–∞–Ω–∏–µ, –ø—Ä–µ–¥–º–µ—Ç –∏ –¥–∞—Ç–∞ –¥–µ–¥–ª–∞–π–Ω–∞)');
                return;
            }

            const taskTime = document.getElementById('taskTime').value;
            const deadlineDateTime = taskTime ? `${deadline}T${taskTime}` : `${deadline}T23:59`;

            const taskId = Date.now();
            const newTask = {
                id: taskId,
                text: title,
                subject: getSubjectName(subject),
                color: subject,
                time: '–¥–æ ' + (taskTime || '23:59'),
                completed: false,
                priority: document.getElementById('taskPriority').value,
                description: document.getElementById('taskDescription').value,
                attachments: [],
                createdAt: new Date().toISOString().split('T')[0],
                deadline: deadline,
                deadlineDateTime: deadlineDateTime,
                notifications: notifications.map(notif => ({
                    ...notif,
                    triggerTime: calculateTriggerTime(deadlineDateTime, notif.value)
                })),
                notes: []
            };

            // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á—É –≤ –¥–∞–Ω–Ω—ã–µ
            if (!tasksByDate[deadline]) {
                tasksByDate[deadline] = [];
            }
            tasksByDate[deadline].push(newTask);

            alert('–ó–∞–¥–∞—á–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!');
            switchScreen('todayScreen');
            updateInterface();
            notifications = []; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø—Ä–µ–¥–º–µ—Ç–∞ –ø–æ –∫–ª—é—á—É
        function getSubjectName(key) {
            const subjects = {
                'math': '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞',
                'physics': '–§–∏–∑–∏–∫–∞',
                'history': '–ò—Å—Ç–æ—Ä–∏—è',
                'programming': '–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ',
                'english': '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫',
                'general': '–û–±—â–µ–µ'
            };
            return subjects[key] || key;
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ –∫ –∑–∞–¥–∞—á–µ
        function addNoteToTask() {
            const noteText = document.getElementById('newNoteText').value.trim();
            if (!noteText) return;

            if (!currentTask.notes) {
                currentTask.notes = [];
            }

            const newNote = {
                id: Date.now(),
                text: noteText,
                createdAt: new Date().toLocaleString('ru-RU', {
                    day: 'numeric',
                    month: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                })
            };

            currentTask.notes.push(newNote);
            document.getElementById('newNoteText').value = '';
            renderTaskDetail();

            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–¥–∞—á—É –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Å–ø–∏—Å–∫–µ
            if (tasksByDate[currentTask.dateKey]) {
                const taskIndex = tasksByDate[currentTask.dateKey].findIndex(t => t.id === currentTask.id);
                if (taskIndex !== -1) {
                    tasksByDate[currentTask.dateKey][taskIndex].notes = currentTask.notes;
                }
            }
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è)
        function renderTaskDetail() {
            const container = document.getElementById('taskDetailContent');
            if (!currentTask) return;

            const priorityText = {
                'high': '–í—ã—Å–æ–∫–∏–π',
                'medium': '–°—Ä–µ–¥–Ω–∏–π',
                'low': '–ù–∏–∑–∫–∏–π'
            };

            container.innerHTML = `
                <div class="task-detail-header">
                    <div class="task-detail-title">
                        <div class="task-detail-checkbox ${currentTask.completed ? 'checked' : ''}"
                             onclick="toggleTaskDetail()"></div>
                        <div class="task-detail-text">${currentTask.text}</div>
                    </div>
                    <div class="task-detail-meta">
                        <div class="detail-row">
                            <div class="detail-label">–ü—Ä–µ–¥–º–µ—Ç:</div>
                            <div class="context-badge badge-${currentTask.color}">${currentTask.subject}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:</div>
                            <div class="priority-badge priority-${currentTask.priority}">
                                ${priorityText[currentTask.priority]}
                            </div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">–°–æ–∑–¥–∞–Ω–∞:</div>
                            <div class="detail-value">${formatDisplayDate(currentTask.createdAt)}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">–î–µ–¥–ª–∞–π–Ω:</div>
                            <div class="detail-value">${formatDisplayDate(currentTask.deadline)} ${currentTask.time.replace('–¥–æ ', '')}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">–°—Ç–∞—Ç—É—Å:</div>
                            <div class="detail-value">${currentTask.completed ? '‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∞' : '‚è≥ –í —Ä–∞–±–æ—Ç–µ'}</div>
                        </div>
                    </div>
                <div class="task-detail-body">
                    <div class="detail-section">
                        <div class="detail-section-title">–û–ø–∏—Å–∞–Ω–∏–µ</div>
                        <div class="description-text">
                            ${currentTask.description ? currentTask.description :
                            '<div class="description-placeholder">–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</div>'}
                        </div>
                    
                    <div class="detail-section">
                        <div class="detail-section-title">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</div>
                        ${currentTask.notifications && currentTask.notifications.length > 0 ? `
                            <div class="notifications-list">
                                ${currentTask.notifications.map(notif => `
                                    <div class="notification-item">
                                        <div>üîî</div>
                                        <div class="notification-time">${notif.text}</div>
                                        <div style="font-size: 12px; color: #888;">
                                            ${formatNotificationTime(notif.triggerTime)}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : '<div class="description-placeholder">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã</div>'}
                    </div>
                    
                    <div class="detail-section notes-section">
                        <div class="detail-section-title">–ó–∞–º–µ—Ç–∫–∏</div>
                        <div class="notes-list" id="taskNotesList">
                            ${currentTask.notes && currentTask.notes.length > 0 ?
                                currentTask.notes.map(note => `
                                    <div class="note-item">
                                        <div class="note-text">${note.text}</div>
                                        <div class="note-meta">
                                            <span>${note.createdAt}</span>
                                        </div>
                                    </div>
                                `).join('') :
                                '<div class="description-placeholder">–ó–∞–º–µ—Ç–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç</div>'
                            }
                        </div>
                        <div class="add-note-form">
                            <input type="text" class="add-note-input" id="newNoteText" placeholder="–î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É...">
                            <button class="add-note-button" onclick="addNoteToTask()">–î–æ–±–∞–≤–∏—Ç—å</button>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="action-button" onclick="editTask()">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button class="action-button primary" onclick="completeTask()">
                            ${currentTask.completed ? 'üîÑ –í–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å' : '‚úÖ –í—ã–ø–æ–ª–Ω–∏—Ç—å'}
                        </button>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>
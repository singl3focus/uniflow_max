# Auth Service gRPC API Documentation

## –û–±–∑–æ—Ä

Auth Service –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç gRPC API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ EasyMusic.

**–ü—Ä–æ—Ç–æ–∫–æ–ª:** gRPC  
**Proto —Ñ–∞–π–ª:** `api/grpc/v1/auth.proto`  
**Package:** `api.grpc.v1`

---

## –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

### Role (Enum)

–†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ:

```protobuf
enum Role {
  ROLE_NONE = 0;      // –ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞
  ROLE_LISTENER = 1;  // –û–±—ã—á–Ω—ã–π —Å–ª—É—à–∞—Ç–µ–ª—å
  ROLE_ACTOR = 2;     // –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å (–º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç)
  ROLE_ADMIN = 3;     // –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
}
```

### User (Message)

–ú–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```protobuf
message User {
  string id = 1;                           // UUID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  string name = 2;                         // –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  string email = 3;                        // Email
  Role role = 4;                          // –†–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  google.protobuf.Timestamp created_at = 5; // –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
  google.protobuf.Timestamp updated_at = 6; // –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
}
```

---

## –ú–µ—Ç–æ–¥—ã —Å–µ—Ä–≤–∏—Å–∞

### 1. Register

–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–∏—Å—Ç–µ–º–µ.

**Request:**
```protobuf
message RegisterRequest {
  string username = 1;  // –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  string email = 2;     // Email (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –≤–∞–ª–∏–¥–∞—Ü–∏—è email)
  string password = 3;  // –ü–∞—Ä–æ–ª—å (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –º–∏–Ω. 8 —Å–∏–º–≤–æ–ª–æ–≤)
}
```

**Response:**
```protobuf
message RegisterResponse {
  string user_id = 1;   // UUID —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
}
```

**–ü—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:**
- `username`: –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ
- `email`: –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ, –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ email
- `password`: –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ, –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤, –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∑–∞–≥–ª–∞–≤–Ω—ã–µ, —Å—Ç—Ä–æ—á–Ω—ã–µ –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã

**–í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏:**
- `InvalidArgument` - –Ω–µ–≤–µ—Ä–Ω—ã–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π email, –∫–æ—Ä–æ—Ç–∫–∏–π –ø–∞—Ä–æ–ª—å)
- `AlreadyExists` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- `Internal` - –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

---

### 2. Login

–ê–≤—Ç–æ—Ä–∏–∑—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT —Ç–æ–∫–µ–Ω—ã.

**Request:**
```protobuf
message LoginRequest {
  string email = 1;     // Email (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –≤–∞–ª–∏–¥–∞—Ü–∏—è email)
  string password = 2;  // –ü–∞—Ä–æ–ª—å (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
}
```

**Response:**
```protobuf
message LoginResponse {
  string access_token = 1;   // JWT access token (—Å—Ä–æ–∫: 15 –º–∏–Ω—É—Ç)
  string refresh_token = 2;  // JWT refresh token (—Å—Ä–æ–∫: 7 –¥–Ω–µ–π)
}
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏:**
- `InvalidArgument` - –Ω–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- `NotFound` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω
- `Internal` - –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

---

### 3. Logout

–ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç refresh —Ç–æ–∫–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã).

**Request:**
```protobuf
message LogoutRequest {
  string user_id = 1;  // UUID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –≤–∞–ª–∏–¥–∞—Ü–∏—è UUID)
}
```

**Response:**
```protobuf
google.protobuf.Empty
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏:**
- `InvalidArgument` - –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π UUID
- `Internal` - –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –û–ø–µ—Ä–∞—Ü–∏—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞ - –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã–∑–æ–≤ –Ω–µ –≤—ã–∑–æ–≤–µ—Ç –æ—à–∏–±–∫—É.

---

### 4. RefreshToken

–û–±–Ω–æ–≤–ª—è–µ—Ç access –∏ refresh —Ç–æ–∫–µ–Ω—ã.

**Request:**
```protobuf
message RefreshTokenRequest {
  string refresh_token = 1;  // –¢–µ–∫—É—â–∏–π refresh token (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
}
```

**Response:**
```protobuf
message RefreshTokenResponse {
  string access_token = 1;   // –ù–æ–≤—ã–π JWT access token
  string refresh_token = 2;  // –ù–æ–≤—ã–π JWT refresh token
}
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏:**
- `InvalidArgument` - –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π –∏–ª–∏ –∏—Å—Ç–µ–∫—à–∏–π refresh token
- `NotFound` - refresh token –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ë–î
- `Internal` - –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –°—Ç–∞—Ä—ã–π refresh token –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.

---

### 5. Check

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å access —Ç–æ–∫–µ–Ω–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ.

**Request:**
```protobuf
message CheckRequest {
  string access_token = 1;  // JWT access token (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
}
```

**Response:**
```protobuf
message CheckResponse {
  string user_id = 1;    // UUID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  string username = 2;   // –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  Role role = 3;         // –†–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  string issued_at = 4;  // –í—Ä–µ–º—è –≤—ã–¥–∞—á–∏ —Ç–æ–∫–µ–Ω–∞ (RFC3339)
  string expires_at = 5; // –í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ (RFC3339)
}
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏:**
- `InvalidArgument` - –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π –∏–ª–∏ –∏—Å—Ç–µ–∫—à–∏–π —Ç–æ–∫–µ–Ω
- `Internal` - –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è API Gateway –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

---

### 6. GetUser

–ü–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –ø–æ ID.

**Request:**
```protobuf
message GetUserRequest {
  string user_id = 1;  // UUID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –≤–∞–ª–∏–¥–∞—Ü–∏—è UUID)
}
```

**Response:**
```protobuf
message GetUserResponse {
  User user = 1;  // –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
}
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏:**
- `InvalidArgument` - –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π UUID
- `NotFound` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω
- `Internal` - –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

---

### 7. UpdateUser

–û–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**Request:**
```protobuf
message UpdateUserRequest {
  string user_id = 1;      // UUID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –≤–∞–ª–∏–¥–∞—Ü–∏—è UUID)
  optional string name = 2;    // –ù–æ–≤–æ–µ –∏–º—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  optional string email = 3;   // –ù–æ–≤—ã–π email (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
}
```

**Response:**
```protobuf
google.protobuf.Empty
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏:**
- `InvalidArgument` - –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- `NotFound` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω
- `AlreadyExists` - email —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
- `Internal` - –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ú–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø–æ–ª—è (—á–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ).

---

### 8. DeleteUser

–£–¥–∞–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Å–∏—Å—Ç–µ–º—ã.

**Request:**
```protobuf
message DeleteUserRequest {
  string user_id = 1;  // UUID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –≤–∞–ª–∏–¥–∞—Ü–∏—è UUID)
}
```

**Response:**
```protobuf
google.protobuf.Empty
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏:**
- `InvalidArgument` - –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π UUID
- `NotFound` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω
- `Internal` - –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

---

### 9. ForgotPassword

–ò–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è (–æ—Ç–ø—Ä–∞–≤–∫–∞ email).

**Request:**
```protobuf
message ForgotPasswordRequest {
  string email = 1;  // Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –≤–∞–ª–∏–¥–∞—Ü–∏—è email)
}
```

**Response:**
```protobuf
message ForgotPasswordResponse {}
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏:**
- `InvalidArgument` - –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π email
- `Internal` - –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

**–°—Ç–∞—Ç—É—Å:** üöß **–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ** - –º–µ—Ç–æ–¥ –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω.

---

## –ö–æ–¥—ã –æ—à–∏–±–æ–∫

–°–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ gRPC status codes:

| gRPC Code | –û–ø–∏—Å–∞–Ω–∏–µ | –ö–æ–≥–¥–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç |
|-----------|----------|-----------------|
| `OK` (0) | –£—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ | - |
| `InvalidArgument` (3) | –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ | –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏, –Ω–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ |
| `NotFound` (5) | –†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å/—Ç–æ–∫–µ–Ω –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç |
| `AlreadyExists` (6) | –†–µ—Å—É—Ä—Å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç | Email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω |
| `Unauthenticated` (16) | –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω | –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π —Ç–æ–∫–µ–Ω |
| `Internal` (13) | –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ | –û—à–∏–±–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ |

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
GRPC_PORT=50051              # –ü–æ—Ä—Ç gRPC —Å–µ—Ä–≤–µ—Ä–∞
PG_DSN=postgres://...        # DSN –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL
LOGGER_LEVEL=info            # –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (debug, info, warn, error)
JWT_SECRET=your-secret-key   # –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ JWT (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
```

### JWT —Ç–æ–∫–µ–Ω—ã

- **Access Token:**
  - –í—Ä–µ–º—è –∂–∏–∑–Ω–∏: 15 –º–∏–Ω—É—Ç
  - –ê–ª–≥–æ—Ä–∏—Ç–º: HS256
  - –°–æ–¥–µ—Ä–∂–∏—Ç: user_id, username, role
  
- **Refresh Token:**
  - –í—Ä–µ–º—è –∂–∏–∑–Ω–∏: 7 –¥–Ω–µ–π
  - –ê–ª–≥–æ—Ä–∏—Ç–º: HS256
  - –°–æ–¥–µ—Ä–∂–∏—Ç: user_id

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### Go Client

```go
import (
    "context"
    "google.golang.org/grpc"
    pb "gitlab.com/easymusic/auth/pkg/api/grpc/v1"
)

func main() {
    conn, err := grpc.Dial("localhost:50051", grpc.WithInsecure())
    if err != nil {
        panic(err)
    }
    defer conn.Close()
    
    client := pb.NewAuthServiceClient(conn)
    
    // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
    resp, err := client.Register(context.Background(), &pb.RegisterRequest{
        Username: "john_doe",
        Email:    "john@example.com",
        Password: "SecurePass123",
    })
    
    // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
    loginResp, err := client.Login(context.Background(), &pb.LoginRequest{
        Email:    "john@example.com",
        Password: "SecurePass123",
    })
    
    accessToken := loginResp.AccessToken
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
    checkResp, err := client.Check(context.Background(), &pb.CheckRequest{
        AccessToken: accessToken,
    })
}
```

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  API Gateway‚îÇ
‚îÇ   (HTTP)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ gRPC
       ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Auth Service‚îÇ
‚îÇ   (gRPC)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PostgreSQL ‚îÇ
‚îÇ   (Users,   ‚îÇ
‚îÇ   Tokens)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–ü–∞—Ä–æ–ª–∏:** –•–µ—à–∏—Ä—É—é—Ç—Å—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º bcrypt (cost=10)
2. **JWT:** –ü–æ–¥–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Å–µ–∫—Ä–µ—Ç–Ω—ã–º –∫–ª—é—á–æ–º (HS256)
3. **Refresh —Ç–æ–∫–µ–Ω—ã:** –•—Ä–∞–Ω—è—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ
4. **–í–∞–ª–∏–¥–∞—Ü–∏—è:** –í—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é protovalidate

---

## –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `migrations/20250912193547_schema.sql`:

```sql
CREATE SCHEMA IF NOT EXISTS auth;

CREATE TABLE auth.users (
    id UUID PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    role INTEGER NOT NULL,
    created_at TIMESTAMPTZ NOT NULL,
    updated_at TIMESTAMPTZ NOT NULL
);

CREATE TABLE auth.user_refresh_tokens (
    user_id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
    token TEXT NOT NULL,
    updated_at TIMESTAMPTZ NOT NULL
);
```

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç structured logging (zerolog) —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –ø–æ–ª—è–º–∏:
- `request_id` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø—Ä–æ—Å–∞
- `method` - –≤—ã–∑–≤–∞–Ω–Ω—ã–π gRPC –º–µ—Ç–æ–¥
- `user_id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
- `error` - —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏
- `duration_ms` - –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞

---

## Roadmap

- [ ] –†–µ–∞–ª–∏–∑–∞—Ü–∏—è ForgotPassword
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ 2FA (Two-Factor Authentication)
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ OAuth2 (Google, GitHub)
- [ ] Rate limiting –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] Session management (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)
- [ ] Audit log –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

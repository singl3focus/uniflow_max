# UniFlow MAX Bot - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## –û–±–∑–æ—Ä

UniFlow MAX Bot ‚Äî –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —á–∞—Ç-–±–æ—Ç –¥–ª—è –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ MAX —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ, –ø—Ä–æ—Å–º–æ—Ç—Ä, –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ)
- üìÅ –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞–º–∏
- üîç –ü–æ–∏—Å–∫–∞ –∑–∞–¥–∞—á
- ‚å®Ô∏è –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª–∞–≤–∏–∞—Ç—É—Ä
- üí¨ –î–∏–∞–ª–æ–≥–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ (FSM)

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```
internal/adapters/max/
‚îú‚îÄ‚îÄ client.go           # MAX API –∫–ª–∏–µ–Ω—Ç (long polling / webhook)
‚îú‚îÄ‚îÄ bot_handler.go      # –ì–ª–∞–≤–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏–π
‚îú‚îÄ‚îÄ bot_commands.go     # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
‚îú‚îÄ‚îÄ bot_callbacks.go    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ callback –æ—Ç –∫–Ω–æ–ø–æ–∫
‚îú‚îÄ‚îÄ bot_keyboards.go    # –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã –∫–ª–∞–≤–∏–∞—Ç—É—Ä
‚îú‚îÄ‚îÄ webhook.go          # Webhook —Å–µ—Ä–≤–µ—Ä
‚îî‚îÄ‚îÄ notification.go     # –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
```

### –°–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (FSM)

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏—Å—Ç–µ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è –¥–∏–∞–ª–æ–≥–æ–≤:

- `creating_task` - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏ (3 —à–∞–≥–∞)
- `creating_context` - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (2 —à–∞–≥–∞)
- `editing_task` - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
- `searching` - –ü–æ–∏—Å–∫ –∑–∞–¥–∞—á

## –ö–æ–º–∞–Ω–¥—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ

- `/start` - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
- `/menu` - –ü–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
- `/help` - –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º

### –ó–∞–¥–∞—á–∏

- `/today` - –ó–∞–¥–∞—á–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
- `/tasks` - –í—Å–µ –∑–∞–¥–∞—á–∏
- `/newtask` - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É
- `/search <–∑–∞–ø—Ä–æ—Å>` - –ü–æ–∏—Å–∫ –∑–∞–¥–∞—á

### –ö–æ–Ω—Ç–µ–∫—Å—Ç—ã

- `/contexts` - –í—Å–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã
- `/newcontext` - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

- `/cancel` - –û—Ç–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ

## –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã

### –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

```
[üìã –°–µ–≥–æ–¥–Ω—è] [‚úÖ –í—Å–µ –∑–∞–¥–∞—á–∏]
[‚ûï –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞] [üìÅ –ö–æ–Ω—Ç–µ–∫—Å—Ç—ã]
[üîç –ü–æ–∏—Å–∫]
```

### –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á

–î–ª—è –∫–∞–∂–¥–æ–π –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–¥–∞—á–∏:
```
[‚úì –ó–∞–≤–µ—Ä—à–∏—Ç—å] [üëÅ –ü—Ä–æ—Å–º–æ—Ç—Ä]
```

–î–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö:
```
[‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä]
```

### –î–µ—Ç–∞–ª–∏ –∑–∞–¥–∞—á–∏

–î–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π:
```
[‚úì –ó–∞–≤–µ—Ä—à–∏—Ç—å] [‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å]
[‚è∞ –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ä–æ–∫] [üóë –£–¥–∞–ª–∏—Ç—å]
[‚óÄÔ∏è –ù–∞–∑–∞–¥ –∫ –∑–∞–¥–∞—á–∞–º]
```

–î–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–π:
```
[‚Ü©Ô∏è –í–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å] [üóë –£–¥–∞–ª–∏—Ç—å]
[‚óÄÔ∏è –ù–∞–∑–∞–¥ –∫ –∑–∞–¥–∞—á–∞–º]
```

### –°–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤

```
[üìÇ –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞] [üìã –ó–∞–¥–∞—á–∏]
...
[‚ûï –ù–æ–≤—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç]
[üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é]
```

### –î–µ—Ç–∞–ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

```
[üìã –ó–∞–¥–∞—á–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞] [‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å]
[üóë –£–¥–∞–ª–∏—Ç—å]
[‚óÄÔ∏è –ù–∞–∑–∞–¥ –∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞–º]
```

## Callback Payloads

### –§–æ—Ä–º–∞—Ç

`<—Ç–∏–ø>_<–¥–µ–π—Å—Ç–≤–∏–µ>_<id>`

### –¢–∏–ø—ã

**menu** - –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –º–µ–Ω—é:
- `menu_main` - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
- `menu_today` - –ó–∞–¥–∞—á–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
- `menu_tasks` - –í—Å–µ –∑–∞–¥–∞—á–∏
- `menu_newtask` - –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
- `menu_contexts` - –í—Å–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã
- `menu_newcontext` - –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç
- `menu_search` - –ü–æ–∏—Å–∫

**task** - –î–µ–π—Å—Ç–≤–∏—è —Å –∑–∞–¥–∞—á–∞–º–∏:
- `task_complete_<id>` - –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–¥–∞—á—É
- `task_view_<id>` - –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–¥–∞—á–∏
- `task_edit_<id>` - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É
- `task_delete_<id>` - –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É (–∑–∞–ø—Ä–æ—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)
- `task_reopen_<id>` - –í–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–¥–∞—á—É
- `task_confirm_<id>` - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è
- `task_cancel_<id>` - –û—Ç–º–µ–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è

**context** - –î–µ–π—Å—Ç–≤–∏—è —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞–º–∏:
- `context_view_<id>` - –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- `context_tasks_<id>` - –ó–∞–¥–∞—á–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- `context_edit_<id>` - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç
- `context_delete_<id>` - –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç (–∑–∞–ø—Ä–æ—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)
- `context_confirm_<id>` - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è
- `context_cancel_<id>` - –û—Ç–º–µ–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è

## –î–∏–∞–ª–æ–≥–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏

1. **–®–∞–≥ 1**: –í–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏—è
   ```
   User: /newtask
   Bot: –®–∞–≥ 1/3: –í–≤–µ–¥–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
   User: –°–¥–µ–ª–∞—Ç—å –¥–æ–º–∞—à–∫—É –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ
   ```

2. **–®–∞–≥ 2**: –í–≤–æ–¥ –æ–ø–∏—Å–∞–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   ```
   Bot: –®–∞–≥ 2/3: –í–≤–µ–¥–∏ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ (–∏–ª–∏ '-' –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞)
   User: –†–µ—à–∏—Ç—å –∑–∞–¥–∞—á–∏ 1-15 –∏–∑ —É—á–µ–±–Ω–∏–∫–∞
   ```

3. **–®–∞–≥ 3**: –í—ã–±–æ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   ```
   Bot: –®–∞–≥ 3/3: –í—ã–±–µ—Ä–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–ª–∏ –≤–≤–µ–¥–∏ '-'
        1. üìö –£—á–µ–±–∞
        2. üíº –†–∞–±–æ—Ç–∞
   User: 1
   Bot: ‚úÖ –ó–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞!
   ```

### –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

1. **–®–∞–≥ 1**: –í–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏—è
   ```
   User: /newcontext
   Bot: –®–∞–≥ 1/2: –í–≤–µ–¥–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
   User: –ü—Ä–æ–µ–∫—Ç—ã
   ```

2. **–®–∞–≥ 2**: –í–≤–æ–¥ –æ–ø–∏—Å–∞–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   ```
   Bot: –®–∞–≥ 2/2: –í–≤–µ–¥–∏ –æ–ø–∏—Å–∞–Ω–∏–µ (–∏–ª–∏ '-' –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞)
   User: –õ–∏—á–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
   Bot: ‚úÖ –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ–∑–¥–∞–Ω!
   ```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í `backend/config.env`:

```env
# MAX Messenger Configuration
MAX_BOT_TOKEN=your-bot-token-here
MAX_WEBHOOK_URL=  # –û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è long polling
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ MAX
2. –ù–∞–π–¥–∏—Ç–µ `@max_master_bot`
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/newbot`
4. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω –≤ `config.env`

### –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

#### Long Polling (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

```env
MAX_WEBHOOK_URL=
```

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –≤ —Ä–µ–∂–∏–º–µ long polling.

#### Webhook (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

```env
MAX_WEBHOOK_URL=https://yourdomain.com/max/webhook
```

1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ HTTPS —Å–µ—Ä–≤–µ—Ä
2. –£–∫–∞–∂–∏—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π URL
3. –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç webhook

### –ó–∞–ø—É—Å–∫

```bash
cd backend
go run cmd/project/main.go
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ max-bot-api-client-go

### –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π

```go
// –ü—Ä–æ—Å—Ç–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
api.Messages.Send(ctx, maxbot.NewMessage().
    SetUser(userID).
    SetText("–ü—Ä–∏–≤–µ—Ç!"))

// –° –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π
kb := &maxbot.Keyboard{}
kb.AddRow().
    AddCallback("–ö–Ω–æ–ø–∫–∞ 1", schemes.DEFAULT, "payload_1").
    AddCallback("–ö–Ω–æ–ø–∫–∞ 2", schemes.POSITIVE, "payload_2")

api.Messages.Send(ctx, maxbot.NewMessage().
    SetUser(userID).
    SetText("–í—ã–±–µ—Ä–∏:").
    AddKeyboard(kb))
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ callback'–æ–≤

```go
case *schemes.MessageCallbackUpdate:
    payload := upd.Callback.Payload
    callbackID := upd.Callback.CallbackID
    
    // –û—Ç–≤–µ—Ç –Ω–∞ callback (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é)
    api.Messages.AnswerOnCallback(ctx, callbackID, &schemes.CallbackAnswer{
        Notification: "‚úÖ –ì–æ—Ç–æ–≤–æ!",
    })
```

### –¢–∏–ø—ã –∫–Ω–æ–ø–æ–∫

```go
// Callback button - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç payload –±–æ—Ç—É
kb.AddRow().AddCallback("–¢–µ–∫—Å—Ç", schemes.DEFAULT, "my_payload")

// Link button - –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç URL
kb.AddRow().AddLink("–û—Ç–∫—Ä—ã—Ç—å", schemes.DEFAULT, "https://example.com")

// Contact button - –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
kb.AddRow().AddContact("–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–º")

// Geolocation button - –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é
kb.AddRow().AddGeolocation("–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é", true)
```

### Intent (—Ü–≤–µ—Ç–∞ –∫–Ω–æ–ø–æ–∫)

- `schemes.DEFAULT` - –û–±—ã—á–Ω–∞—è (—Å–∏–Ω—è—è)
- `schemes.POSITIVE` - –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è (–∑–µ–ª–µ–Ω–∞—è)
- `schemes.NEGATIVE` - –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è (–∫—Ä–∞—Å–Ω–∞—è)

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏

```
User: [–Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "üìã –í—Å–µ –∑–∞–¥–∞—á–∏"]
Bot: üìù –í—Å–µ–≥–æ –∑–∞–¥–∞—á: 3
     
     ‚≠ï –ê–∫—Ç–∏–≤–Ω—ã–µ (2):
     ‚Ä¢ –°–¥–µ–ª–∞—Ç—å –¥–æ–º–∞—à–∫—É
     ‚Ä¢ –ü–æ–∑–≤–æ–Ω–∏—Ç—å –∑–∞–∫–∞–∑—á–∏–∫—É
     
     [‚úì –ó–∞–≤–µ—Ä—à–∏—Ç—å] [üëÅ –ü—Ä–æ—Å–º–æ—Ç—Ä]  <- –¥–ª—è –ø–µ—Ä–≤–æ–π –∑–∞–¥–∞—á–∏
     [‚úì –ó–∞–≤–µ—Ä—à–∏—Ç—å] [üëÅ –ü—Ä–æ—Å–º–æ—Ç—Ä]  <- –¥–ª—è –≤—Ç–æ—Ä–æ–π –∑–∞–¥–∞—á–∏

User: [–Ω–∞–∂–∏–º–∞–µ—Ç "‚úì –ó–∞–≤–µ—Ä—à–∏—Ç—å" –¥–ª—è –ø–µ—Ä–≤–æ–π –∑–∞–¥–∞—á–∏]
Bot: ‚úÖ –ó–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!
     
     üìù –°–¥–µ–ª–∞—Ç—å –¥–æ–º–∞—à–∫—É
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –∑–∞–¥–∞—á–∏

```
User: [–Ω–∞–∂–∏–º–∞–µ—Ç "üëÅ –ü—Ä–æ—Å–º–æ—Ç—Ä"]
Bot: üìù –°–¥–µ–ª–∞—Ç—å –¥–æ–º–∞—à–∫—É
     
     –°—Ç–∞—Ç—É—Å: ‚≠ï –í —Ä–∞–±–æ—Ç–µ
     
     üìÑ –û–ø–∏—Å–∞–Ω–∏–µ:
     –†–µ—à–∏—Ç—å –∑–∞–¥–∞—á–∏ 1-15 –∏–∑ —É—á–µ–±–Ω–∏–∫–∞
     
     ‚è∞ –°—Ä–æ–∫: 15.11.2025 18:00
     
     üìö –ö–æ–Ω—Ç–µ–∫—Å—Ç: –£—á–µ–±–∞
     
     [‚úì –ó–∞–≤–µ—Ä—à–∏—Ç—å] [‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å]
     [‚è∞ –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ä–æ–∫] [üóë –£–¥–∞–ª–∏—Ç—å]
     [‚óÄÔ∏è –ù–∞–∑–∞–¥ –∫ –∑–∞–¥–∞—á–∞–º]
```

### –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ —á–µ—Ä–µ–∑ –¥–∏–∞–ª–æ–≥

```
User: /newtask
Bot: üìù –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏
     
     –®–∞–≥ 1/3: –í–≤–µ–¥–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
     
     –ò–ª–∏ /cancel –¥–ª—è –æ—Ç–º–µ–Ω—ã

User: –ö—É–ø–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã
Bot: üìù –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏
     
     –ù–∞–∑–≤–∞–Ω–∏–µ: –ö—É–ø–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã ‚úì
     
     –®–∞–≥ 2/3: –í–≤–µ–¥–∏ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
     
     –ò–ª–∏ –Ω–∞–ø–∏—à–∏ '-' —á—Ç–æ–±—ã –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å

User: –ú–æ–ª–æ–∫–æ, —Ö–ª–µ–±, —è–π—Ü–∞
Bot: üìù –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏
     
     –ù–∞–∑–≤–∞–Ω–∏–µ: –ö—É–ø–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã ‚úì
     –û–ø–∏—Å–∞–Ω–∏–µ: ‚úì
     
     –®–∞–≥ 3/3: –í—ã–±–µ—Ä–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–ª–∏ –≤–≤–µ–¥–∏ '-'
     
     –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã:
     1. üìö –£—á–µ–±–∞
     2. üíº –†–∞–±–æ—Ç–∞
     3. üè† –õ–∏—á–Ω–æ–µ
     
     –í–≤–µ–¥–∏ –Ω–æ–º–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–ª–∏ '-'

User: 3
Bot: ‚úÖ –ó–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞!
     
     üìù –ö—É–ø–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã
     üìÑ –ú–æ–ª–æ–∫–æ, —Ö–ª–µ–±, —è–π—Ü–∞
```

## –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é zerolog:

```go
h.logger.Info("received message from user", "user_id", userID, "text", text)
h.logger.Error("failed to get task", "error", err, "task_id", taskID)
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π

```go
// –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
state, exists := h.userStates[userID]
if exists {
    fmt.Printf("User %d state: %s, step: %v\n", 
        userID, state.State, state.Data["step"])
}
```

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –ø–ª–∞–Ω—ã

### –¢–µ–∫—É—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –°–æ—Å—Ç–æ—è–Ω–∏—è —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ (–ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ —Ç–µ—Ä—è—é—Ç—Å—è)
- –ú–∞–∫—Å–∏–º—É–º 5 –∑–∞–¥–∞—á/–∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ –≤ –æ–¥–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ
- –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∑–∞–¥–∞—á
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π –≤ Redis
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π —á–µ—Ä–µ–∑ –±–æ—Ç–∞
- [ ] –í–ª–æ–∂–µ–Ω–∏—è (—Ñ–∞–π–ª—ã, —Ñ–æ—Ç–æ) –∫ –∑–∞–¥–∞—á–∞–º
- [ ] –ì—Ä—É–ø–ø–æ–≤—ã–µ —á–∞—Ç—ã –∏ —Å–æ–≤–º–µ—Å—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç—ã
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–º
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –∑–∞–¥–∞—á –≤ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã

## Troubleshooting

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ `config.env`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω

### Callback –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç payload (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `—Ç–∏–ø_–¥–µ–π—Å—Ç–≤–∏–µ_id`)
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ `handleCallback`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏

### –°–æ—Å—Ç–æ—è–Ω–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

–°–æ—Å—Ç–æ—è–Ω–∏—è —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –∏ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏:
- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ª—é–±–æ–π –∫–æ–º–∞–Ω–¥—ã (–∫—Ä–æ–º–µ /cancel)
- –ò—Å—Ç–µ—á–µ–Ω–∏–∏ —Ç–∞–π–º–∞—É—Ç–∞ (–µ—Å–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

- GitHub: https://github.com/singl3focus/uniflow
- Issues: https://github.com/singl3focus/uniflow/issues
- MAX Bot API: https://dev.max.ru/

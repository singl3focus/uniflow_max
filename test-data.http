### UniFlow API - Тестовые данные для эндпоинтов
### Используйте REST Client extension в VS Code или HTTPie/curl

@baseUrl = http://localhost:50031
@token = YOUR_JWT_TOKEN_HERE

### 1. Health Check
GET {{baseUrl}}/health

### ============================================
### Authentication
### ============================================

### 2. Аутентификация через MAX (получение JWT токена)
POST {{baseUrl}}/api/auth/max
Content-Type: application/json

{
  "max_user_id": "123456789"
}

### ============================================
### Contexts (Контексты)
### ============================================

### 3. Получить все контексты пользователя
GET {{baseUrl}}/api/contexts
Authorization: Bearer {{token}}

### 4. Создать контекст - Учёба (Математика)
POST {{baseUrl}}/api/contexts
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "type": "study",
  "title": "Математика",
  "description": "Высшая математика, 3 курс",
  "color": "#FF5733",
  "subject_id": null,
  "deadline_at": "2025-12-31T23:59:59Z"
}

### 5. Создать контекст - Проект
POST {{baseUrl}}/api/contexts
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "type": "project",
  "title": "Дипломный проект",
  "description": "Разработка веб-приложения для управления задачами",
  "color": "#3498DB",
  "subject_id": null,
  "deadline_at": "2026-06-01T00:00:00Z"
}

### 6. Создать контекст - Личное
POST {{baseUrl}}/api/contexts
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "type": "personal",
  "title": "Спорт",
  "description": "Тренировки и здоровье",
  "color": "#2ECC71",
  "subject_id": null,
  "deadline_at": null
}

### 7. Получить контекст по ID
GET {{baseUrl}}/api/contexts/CONTEXT_ID_HERE
Authorization: Bearer {{token}}

### 8. Обновить контекст - Полное обновление
PATCH {{baseUrl}}/api/contexts/CONTEXT_ID_HERE
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "type": "study",
  "title": "Математика (обновлено)",
  "description": "Высшая математика, 3 курс - подготовка к экзамену",
  "color": "#E74C3C",
  "subject_id": null,
  "deadline_at": "2025-12-20T23:59:59Z"
}

### 8a. Обновить контекст - Только цвет (частичное обновление)
PATCH {{baseUrl}}/api/contexts/CONTEXT_ID_HERE
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "color": "#9B59B6"
}

### 8b. Обновить контекст - Только заголовок и описание
PATCH {{baseUrl}}/api/contexts/CONTEXT_ID_HERE
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "title": "Физика",
  "description": "Механика и термодинамика"
}

### 9. Удалить контекст
DELETE {{baseUrl}}/api/contexts/CONTEXT_ID_HERE
Authorization: Bearer {{token}}

### ============================================
### Tasks (Задачи)
### ============================================

### 10. Получить все задачи пользователя
GET {{baseUrl}}/api/tasks
Authorization: Bearer {{token}}

### 11. Получить задачи на сегодня
GET {{baseUrl}}/api/tasks/today
Authorization: Bearer {{token}}

### 12. Создать задачу - Домашнее задание
POST {{baseUrl}}/api/tasks
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "context_id": "CONTEXT_ID_HERE",
  "title": "Решить задачи по матанализу",
  "description": "Глава 5, задачи 1-15",
  "due_at": "2025-11-15T18:00:00Z"
}

### 13. Создать задачу - Без контекста
POST {{baseUrl}}/api/tasks
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "context_id": null,
  "title": "Купить продукты",
  "description": "Молоко, хлеб, яйца",
  "due_at": "2025-11-13T20:00:00Z"
}

### 14. Создать задачу - Проект
POST {{baseUrl}}/api/tasks
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "context_id": "CONTEXT_ID_HERE",
  "title": "Написать документацию API",
  "description": "OpenAPI спецификация для всех эндпоинтов",
  "due_at": "2025-11-20T23:59:59Z"
}

### 15. Создать задачу - Срочная на сегодня
POST {{baseUrl}}/api/tasks
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "context_id": null,
  "title": "Позвонить врачу",
  "description": "Записаться на приём",
  "due_at": "2025-11-13T17:00:00Z"
}

### 16. Получить задачу по ID
GET {{baseUrl}}/api/tasks/TASK_ID_HERE
Authorization: Bearer {{token}}

### 17. Обновить задачу - Полное обновление
PATCH {{baseUrl}}/api/tasks/TASK_ID_HERE
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "context_id": "CONTEXT_ID_HERE",
  "title": "Решить задачи по матанализу (обновлено)",
  "description": "Глава 5, задачи 1-20 + дополнительные",
  "due_at": "2025-11-16T18:00:00Z"
}

### 17a. Обновить задачу - Только заголовок (частичное обновление)
PATCH {{baseUrl}}/api/tasks/TASK_ID_HERE
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "title": "Новый заголовок задачи"
}

### 17b. Обновить задачу - Только дедлайн
PATCH {{baseUrl}}/api/tasks/TASK_ID_HERE
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "due_at": "2025-12-01T23:59:59Z"
}

### 18. Обновить статус задачи - В процессе
PATCH {{baseUrl}}/api/tasks/TASK_ID_HERE/status
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "status": "in_progress"
}

### 19. Обновить статус задачи - Выполнена
PATCH {{baseUrl}}/api/tasks/TASK_ID_HERE/status
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "status": "completed"
}

### 20. Обновить статус задачи - Отменена
PATCH {{baseUrl}}/api/tasks/TASK_ID_HERE/status
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "status": "cancelled"
}

### 21. Удалить задачу
DELETE {{baseUrl}}/api/tasks/TASK_ID_HERE
Authorization: Bearer {{token}}

### ============================================
### Search (Поиск)
### ============================================

### 22. Поиск по задачам и контекстам
GET {{baseUrl}}/api/search?q=математика
Authorization: Bearer {{token}}

### 23. Поиск - другой пример
GET {{baseUrl}}/api/search?q=проект
Authorization: Bearer {{token}}

### 24. Поиск - пустой запрос (должен вернуть ошибку)
GET {{baseUrl}}/api/search?q=
Authorization: Bearer {{token}}

### ============================================
### Примеры ошибок
### ============================================

### 25. Ошибка - Неверный JWT токен
GET {{baseUrl}}/api/tasks
Authorization: Bearer invalid_token_here

### 26. Ошибка - Отсутствие токена
GET {{baseUrl}}/api/tasks

### 27. Ошибка - Неверный ID контекста
GET {{baseUrl}}/api/contexts/invalid-uuid
Authorization: Bearer {{token}}

### 28. Ошибка - Контекст не найден
GET {{baseUrl}}/api/contexts/00000000-0000-0000-0000-000000000000
Authorization: Bearer {{token}}

### 29. Ошибка - Неверное тело запроса
POST {{baseUrl}}/api/contexts
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "invalid_field": "value"
}

### ============================================
### Сценарий: Полный рабочий процесс
### ============================================

### Шаг 1: Аутентификация
# @name auth
POST {{baseUrl}}/api/auth/max
Content-Type: application/json

{
  "max_user_id": "987654321"
}

### Шаг 2: Создать контекст для учёбы
# @name createContext
POST {{baseUrl}}/api/contexts
Authorization: Bearer {{auth.response.body.token}}
Content-Type: application/json

{
  "type": "study",
  "title": "Программирование",
  "description": "Изучение Go и архитектуры приложений",
  "color": "#9B59B6",
  "subject_id": null,
  "deadline_at": "2026-01-31T23:59:59Z"
}

### Шаг 3: Создать задачу в этом контексте
# @name createTask
POST {{baseUrl}}/api/tasks
Authorization: Bearer {{auth.response.body.token}}
Content-Type: application/json

{
  "context_id": "{{createContext.response.body.id}}",
  "title": "Изучить Clean Architecture",
  "description": "Прочитать книгу и применить на практике",
  "due_at": "2025-11-30T23:59:59Z"
}

### Шаг 4: Обновить статус задачи
PATCH {{baseUrl}}/api/tasks/{{createTask.response.body.id}}/status
Authorization: Bearer {{auth.response.body.token}}
Content-Type: application/json

{
  "status": "in_progress"
}

### Шаг 5: Получить все задачи
GET {{baseUrl}}/api/tasks
Authorization: Bearer {{auth.response.body.token}}

### Шаг 6: Поиск
GET {{baseUrl}}/api/search?q=architecture
Authorization: Bearer {{auth.response.body.token}}
